<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Sticky UX on the Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, minimal-ui" />
    <link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|Crimson+Text' rel='stylesheet' type='text/css'>

    <script>
      (function () {
        var de = document.documentElement;
        de.className = de.className+' js';
      })();
    </script>
    <link rel="stylesheet" href="/assets/app-3a7f53a5b01542b9483eddfcb4aaeac2.css">
  </head>
  <body>
    <div class="site">
      <header class='header domino-1'>
  <div class='content-width'>
    <div class='header-content'>
      <h1 class='header-title sans-bold'>
        <a class='no-underline home-link' href='/'>
          <span class='back'>
            <
          </span>
          <span class='link-text'>
            Moudy Elkammash
          </span>
        </a>
      </h1>
    </div>
  </div>
</header>


      <div class='content-width text post-container'>
  <h1>Sticky UX on the Web</h1>
  <div class="subtitle">18 Apr 2014</div>

  <div class="post">
  <p>I usually prefer the experince of native applications over web based ones. Web applicatons feel transient, like hotel rooms. Once you leave â€“ they reset. Good software feels like it belings to you.</p>

<p>Native applications generally do a better job of restoring state because the concept is build into the platform. iOS has <a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIViewController_Class/Reference/Reference.html#//apple_ref/occ/instm/UIViewController/encodeRestorableStateWithCoder:">encodeRestorableStateWithCoder:</a> and <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/Reference/Reference.html#//apple_ref/occ/instm/NSUserDefaults/registerDefaults%3a">NSUserDefaults</a>. There is a right way to do it, so it&#39;s easy for iOS apps to take advangate of the APIs.</p>

<p>There is no &quot;right way&quot; on the web. At a high level a web app&#39;s state is represented by it&#39;s URL. But what about finer grained sub-states like which tab is active? You could store that information in localStorage or a cookie. But making execptions for ceratin properties and working with the browser&#39;s APIs might be enough friction to not bother at all.</p>

<p>Modern browsers (including IE9) support <code>Object.defineProperty</code> which you can use to hide the implimentation details of saving state to the user&#39;s browser. Let&#39;s look at an example.</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="kd">function</span> <span class="nx">clientStateGet</span> <span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">property</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">clientStateSet</span> <span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">userSession</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">userSession</span><span class="p">,</span> <span class="s1">&#39;activeTab&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">get</span><span class="o">:</span> <span class="nx">clientStateGet</span><span class="p">(</span><span class="s1">&#39;activeTab&#39;</span><span class="p">)</span>
<span class="p">,</span> <span class="nx">set</span><span class="o">:</span> <span class="nx">clientStateSet</span><span class="p">(</span><span class="s1">&#39;activeTab&#39;</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">userSession</span><span class="p">.</span><span class="nx">activeTab</span> <span class="o">=</span> <span class="s1">&#39;profileTab&#39;</span><span class="p">;</span> <span class="c1">// saves to localStorage</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">userSession</span><span class="p">.</span><span class="nx">activeTab</span><span class="p">);</span> <span class="c1">// &#39;profileTab&#39;</span>
</code></pre></div>
<p>There&#39;s also a nice shorthand for using <code>Object.defineProperty</code> if you want to define get/set on the object literal.</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="kd">var</span> <span class="nx">userSession</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">get</span> <span class="nx">activeTab</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">clientStateGet</span><span class="p">(</span><span class="s1">&#39;activeTab&#39;</span><span class="p">)();</span>
  <span class="p">}</span>

<span class="p">,</span> <span class="nx">set</span> <span class="nx">activeTab</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">clientStateSet</span><span class="p">(</span><span class="s1">&#39;activeTab&#39;</span><span class="p">)(</span><span class="nx">value</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>After setting up the getter and setter your application code doesn&#39;t need to worry about the implimentation details of how the state is stored. You can simply set the <code>activeTab</code> property on the <code>userSession</code> object it will persist between reloads. </p>

<h2>Get &amp; Set with Frameworks</h2>

<p>If you are using a library or framework like Backbone or Ember then you can easily apply the equivilant of <code>Object.defineProperty</code>.</p>

<p>In Ember you can mark any funtion on an object as a property by calling <code>.property()</code> on the funtcion. That function acts as both a getter and setter depending on the number of arguments passed. This makes it really easy to retrieve and store a propery somewhere other than the object.</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="kd">var</span> <span class="nx">UserSession</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

  <span class="nx">activeTab</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// create a unique key since localStorage</span>
    <span class="c1">// is one big key/value store</span>
    <span class="kd">var</span> <span class="nx">localStorageKey</span> <span class="o">=</span> <span class="s1">&#39;UserSession:&#39;</span><span class="o">+</span><span class="nx">key</span><span class="p">;</span>

    <span class="c1">// if Setter</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localStorageKey</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">localStorageKey</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">property</span><span class="p">()</span>

<span class="p">});</span>

<span class="kd">var</span> <span class="nx">userSession</span> <span class="o">=</span> <span class="nx">UserSession</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>

<span class="nx">userSession</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;activeTab&#39;</span><span class="p">,</span> <span class="s1">&#39;profileTab&#39;</span><span class="p">);</span> <span class="c1">// saves to localStorage</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">userSession</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;activeTab&#39;</span><span class="p">));</span> <span class="c1">// &#39;profileTab&#39;</span>
</code></pre></div>
<p>If you&#39;re using Backbone you could intercept calls to <code>get</code> and <code>set</code>.</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="kd">var</span> <span class="nx">UserSession</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

  <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// call super for original behavoir</span>
    <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">localStorageKey</span> <span class="o">=</span> <span class="s1">&#39;UserSession:&#39;</span><span class="o">+</span><span class="nx">key</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">localStorageKey</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">attriubtes</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
  <span class="p">}</span>

<span class="p">,</span> <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">localStorageKey</span> <span class="o">=</span> <span class="s1">&#39;UserSession:&#39;</span><span class="o">+</span><span class="nx">key</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">localStorageKey</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">});</span>
</code></pre></div>
<h2>Real World Example</h2>

<p><a href="https://parse.com/">Parse</a> has a switch on their dashboard app that lets you toggle the interface between light and dark.</p>

<p><img src="/images/parse-switch.jpg" alt="Parse interface color switch"></p>

<p>Parse stores the setting in a cookie. If the user changes it to &quot;Dark&quot; and switched computers or browsers it would reset back to &quot;Light&quot;. Here&#39;s the code:</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="nx">App</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">Dashboard</span><span class="p">.</span><span class="nx">ColorSwitch</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

  <span class="nx">events</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;click .color_switch .switch&quot;</span><span class="o">:</span> <span class="s2">&quot;switchOption&quot;</span><span class="p">}</span>

<span class="p">,</span> <span class="nx">COOKIE_NAME</span><span class="o">:</span> <span class="s2">&quot;parseDashboardColor&quot;</span>

<span class="p">,</span> <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">COOKIE_NAME</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;dark&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;dark_dashboard&quot;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.color_switch&quot;</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.switch&quot;</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.switch_cursor&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;rightValue&quot;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.color_switch&quot;</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.label&quot;</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s2">&quot;selectedLabel&quot;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">,</span> <span class="nx">switchColor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="s2">&quot;dark&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;dark_dashboard&quot;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;dark_dashboard&quot;</span><span class="p">);</span>
      <span class="nx">a</span> <span class="o">=</span> <span class="s2">&quot;light&quot;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;dark_dashboard&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
    <span class="nx">b</span><span class="p">.</span><span class="nx">setTime</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3000</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">COOKIE_NAME</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="p">{</span><span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="nx">expires</span><span class="o">:</span> <span class="nx">b</span><span class="p">.</span><span class="nx">toGMTString</span><span class="p">()})</span>
  <span class="p">}</span>

<span class="p">,</span> <span class="nx">switchOption</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="s2">&quot;dark&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;switch_cursor&quot;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s2">&quot;rightValue&quot;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.label&quot;</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s2">&quot;selectedLabel&quot;</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.switch_cursor&quot;</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s2">&quot;rightValue&quot;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.label&quot;</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s2">&quot;selectedLabel&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;dark_dashboard&quot;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;dark_dashboard&quot;</span><span class="p">);</span>
      <span class="nx">a</span> <span class="o">=</span> <span class="s2">&quot;light&quot;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;dark_dashboard&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
    <span class="nx">b</span><span class="p">.</span><span class="nx">setTime</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3000</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">COOKIE_NAME</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="p">{</span><span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="nx">expires</span><span class="o">:</span> <span class="nx">b</span><span class="p">.</span><span class="nx">toGMTString</span><span class="p">()})</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>And here&#39;s the cookie:
<img src="/images/parse-cookie.jpg" alt="Parse inteface color cookie"></p>

<p>I was suprised to see all this logic in a <code>Backbone.View</code>. It might not be a big issue if the interface color is the only setting that needs to bas saved to the user&#39;s browser. But if you are saving several properites you can see how abstracting this logoc into a `UserSettings&#39; model that automaticllly saves it&#39;s attributes to the client.</p>

<p>As more native style applications are being built for the browser envoirnment state retoration will become a important. Thinking about how this data is stored early in your applicationt will make it much earier to give the user a consistent experince and expirement with what settings should or should not persist.</p>

  </div>
</div>


      <footer class='footer domino-5'>
  <div class='content-width'>
    <div class='footer-links'>
      <script>
        var emailAddr = ('me@' + 'moudy.me');
        document.write('<a class="footer-link" href="mailto:'+emailAddr+'">Email</a>');
      </script>
      <a class='footer-link' target='_blank' href='http://github.com/moudy/'>GitHub</a>
      <a class='footer-link' target='_blank' href='http://twitter.com/moudy/'>Twitter</a>
    </div>
  </div>
</footer>

    </div>

    <script src="/assets/app-1fa3b5298b3eb966b91a7b173c233232.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-48782540-1', 'moudy.me');
      ga('send', 'pageview');
    </script>
  </body>
</html>
